.short-import-box, .short-import-box > div {
    min-height: 40px !important;
    height: 40px !important;
}
/* Image container styling - more aggressive approach */
.contain-image, .contain-image > div, .contain-image > div > img {
    object-fit: contain !important;
}

#non-mirrored-video {
    transform: scaleX(-1) !important;
}

/* Target all images in the contain-image class and its children */
.contain-image img,
.contain-image > div > img,
.contain-image * img {
    object-fit: contain !important;
    width: 100% !important;
    height: 60vh !important;
    max-height: 100% !important;
    max-width: 100% !important;
}

/* Additional selectors to override Gradio defaults */
.gradio-container img,
.gradio-container .svelte-1b5oq5x,
.gradio-container [data-testid="image"] img {
    object-fit: contain !important;
}

/* Toolbar styling */
#fixed-toolbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    z-index: 1000;
    background: #333;
    color: #fff;
    padding: 0px 10px; /* Reduced top/bottom padding */
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* Responsive toolbar title */
.toolbar-title {
    font-size: 1.4rem;
    margin: 0;
    color: white;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Toolbar Patreon link */
.toolbar-patreon {
    margin: 0 0 0 20px;
    color: white;
    font-size: 0.9rem;
    white-space: nowrap;
    display: inline-block;
}
.toolbar-patreon a {
    color: white;
    text-decoration: none;
}
.toolbar-patreon a:hover {
    text-decoration: underline;
}

/* Toolbar Version number */
.toolbar-version {
    margin: 0 15px; /* Space around version */
    color: white;
    font-size: 0.8rem;
    white-space: nowrap;
    display: inline-block;
}

/* Responsive design for screens */
@media (max-width: 1147px) {
    .toolbar-patreon, .toolbar-version { /* Hide both on smaller screens */
        display: none;
    }
    .footer-patreon, .footer-version { /* Show both in footer on smaller screens */
        display: inline-block !important; /* Ensure they are shown */
    }
    #fixed-toolbar {
        gap: 4px !important; /* Reduce gap for screens <= 1024px */
    }
    #fixed-toolbar > div:first-child { /* Target the first gr.Column (Title) */
        min-width: fit-content !important; /* Override Python-set min-width */
        flex-shrink: 0 !important; /* Prevent title column from shrinking too much */
    }
}

@media (min-width: 1148px) {
    .footer-patreon, .footer-version { /* Hide both in footer on larger screens */
        display: none !important;
    }
}

@media (max-width: 768px) {
    .toolbar-title {
        font-size: 1.1rem;
        max-width: 150px;
    }
    #fixed-toolbar {
        padding: 3px 6px;
        gap: 4px;
    }
    .toolbar-text {
        font-size: 0.75rem;
    }
}

@media (max-width: 510px) {
    #toolbar-ram-col, #toolbar-vram-col, #toolbar-gpu-col {
        display: none !important;
    }
}

@media (max-width: 480px) {
    .toolbar-title {
        font-size: 1rem;
        max-width: 120px;
    }
    #fixed-toolbar {
        padding: 2px 4px;
        gap: 2px;
    }
    .toolbar-text {
        font-size: 0.7rem;
    }
}

/* Button styling */
#toolbar-add-to-queue-btn button {
    font-size: 14px !important;
    padding: 4px 16px !important;
    height: 32px !important;
    min-width: 80px !important;
}
.narrow-button {
    min-width: 40px !important;
    width: 40px !important;
    padding: 0 !important;
    margin: 0 !important;
}
.gr-button-primary {
    color: white;
}

/* Layout adjustments */
body, .gradio-container {
    padding-top: 30px !important; /* Shorter toolbar offset */
}

@media (max-width: 848px) {
    body, .gradio-container {
        padding-top: 36px !important;
    }
}

@media (max-width: 768px) {
    body, .gradio-container {
        padding-top: 20px !important; /* Shorter toolbar offset */
    }
}

@media (max-width: 480px) {
    body, .gradio-container {
        padding-top: 16px !important; /* Shorter toolbar offset */
    }
}

/* hide the gr.Video source selection bar for tb_input_video_component */
#toolbox-video-player .source-selection {
    display: none !important;
}
/* control sizing for gr.Video components */    
.video-size video {
    max-height: 60vh;
    min-height: 300px !important;
    object-fit: contain;
}
/* NEW: Closes the gap between input tabs and the pipeline accordion below them */
#pipeline-controls-wrapper {
    margin-top: -15px !important; /* Adjust this value to get the perfect "snug" fit */
}
/* --- NEW CSS RULE FOR GALLERY SCROLLING --- */
#gallery-scroll-wrapper {
    max-height: 600px; /* Set your desired fixed height */
    overflow-y: auto;   /* Add a scrollbar only when needed */
}
#toolbox-start-pipeline-btn {
    margin-top: -14px !important; /* Adjust this value to get the perfect alignment */
}

.control-group {
    border-top: 1px solid #ccc;
    border-bottom: 1px solid #ccc;
    margin: 12px 0;
}

/* Queue Styles */
/* Queue Container */

/* Ensure queue text is readable in both light & dark modes */
.queue-row,
.queue-row * {
  color: var(--text-color, #111) !important;
}

.queue-row-prompt-text,
.queue-row-setting-label,
.queue-row-setting-value,
.queue-row-timings,
.queue-row-timing-started,
.queue-row-timing-elapsed,
.queue-row-timing-completed {
  color: var(--text-color, #111) !important;
}

/* Light-theme overrides: these target OS/browser light preference and common Gradio theme attributes.
   They make the queue backgrounds lighter and adjust pill/text contrast for readability. */
@media (prefers-color-scheme: light) {
  /* Make row containers light and add a subtle separation */
  .queue-row {
    background-color: transparent !important;
    box-shadow: 0 1px 2px rgba(0,0,0,0.03) !important;
  }

  .queue-row-details,
  .queue-row-prompt,
  .queue-row-timings,
  .queue-row-settings {
    background-color: #f7f7f7 !important;
    color: #111 !important;
  }

  /* Lighten/reset preview image border/background */
  .queue-row-preview img {
    border-color: rgba(0,0,0,0.06);
    background: rgba(255,255,255,0.98);
  }

  /* Ensure pill text is legible and maintain accent */
  .queue-row-setting-label,
  .queue-row-setting-value {
    color: #0b5bd7 !important;
    background: rgba(74,158,255,0.12) !important;
  }

  /* Make status badges softer in light mode so they don't create a large dark block */
  .queue-row-status-pending { background: #ececec !important; }
  .queue-row-status-running { background: rgba(33,150,243,0.12) !important; }
  .queue-row-status-completed { background: rgba(76,175,80,0.12) !important; }
  .queue-row-status-failed { background: rgba(244,67,54,0.12) !important; }
  .queue-row-status-cancelled { background: rgba(133,77,14,0.08) !important; }
  .queue-row-status-cancelling { background: rgba(217,119,6,0.12) !important; }

  /* Ensure status icons keep their color */
  .queue-row-status-icon { color: inherit !important; }
}

/* Some Gradio builds expose a data-theme attribute; cover that too */
[data-theme="light"] .queue-row-details,
[data-theme="light"] .queue-row-prompt,
[data-theme="light"] .queue-row-timings,
[data-theme="light"] .queue-row-settings,
body[data-theme="light"] .queue-row-details,
body[data-theme="light"] .queue-row-prompt,
.gradio-container[data-theme="light"] .queue-row-details,
.gradio-container[data-theme="light"] .queue-row-prompt {
  background-color: #f7f7f7 !important;
  color: #111 !important;
}

.queue-container {
  border-radius: 8px;
  overflow: hidden;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  margin: 16px 0;
}

/* Queue Row */
.queue-row {
  display: grid;
  grid-template-columns: 40px 1fr 220px 150px;
  border-radius: 15px;
  transition: background-color 0.2s ease;
  align-items: start;
  overflow: hidden;
  margin-bottom: 25px;
  position: relative;
}

.queue-row-details {
  background-color: var(--background-fill-primary, #f7f7f7);
  border: 1px solid rgba(0,0,0,0.06);
}

.queue-row-prompt {
  padding: 10px;
  background-color: var(--background-fill-primary, #f7f7f7);
  border-bottom: 1px solid rgba(0,0,0,0.04);
}

.queue-row-prompt-text {
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  line-clamp: 3;
}

/* Settings Pills */
.queue-row-settings {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
  padding: 10px;
  background-color: var(--background-fill-primary, #f7f7f7);
  border-top-left-radius: 15px;
  border-top-right-radius: 15px;
  box-shadow: 0 1px 0 rgba(0,0,0,0.04);
}

.queue-row-setting-pill {
  display: inline-flex;
  font-size: 11px;
  line-height: 1;
  border-radius: 12px;
  overflow: hidden;
}

.queue-row-setting-label {
  background: rgba(74, 158, 255, 0.2);
  color: #4a9eff;
  padding: 4px 8px;
}

.queue-row-setting-value {
  background: rgba(74, 158, 255, 0.1);
  color: #4a9eff;
  padding: 4px 8px;
}

/* Status Badge */
.queue-row-status {
  width: 40px;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  border-bottom-right-radius: 15px;
}

/* Status Colors */
.queue-row-status-pending {
  background: #2a2a2a;
}

.queue-row-status-running {
  background: #1a4b7c;
}

.queue-row-status-completed {
  background: #1b5e20;
}

.queue-row-status-failed {
  background: #7f1d1d;
}

.queue-row-status-cancelled {
  background: #854d0e;
}

.queue-row-status-cancelling {
  background: #d97706;
}

/* Status Icons */
.queue-row-status-icon {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.queue-row-status-pending .queue-row-status-icon {
  color: #9e9e9e;
}

.queue-row-status-running .queue-row-status-icon {
  color: #2196f3;
}

.queue-row-status-completed .queue-row-status-icon {
  color: #4caf50;
}

.queue-row-status-failed .queue-row-status-icon {
  color: #f44336;
}

.queue-row-status-cancelled .queue-row-status-icon {
  color: #ffc107;
}

.queue-row-status-cancelling .queue-row-status-icon {
  color: #f59e0b;
}

/* Timings */
.queue-row-timings {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 10px;
  margin-right: 10px;
  background-color: var(--background-fill-primary, #f7f7f7);
  border-top-right-radius: 15px;
  border-bottom-left-radius: 15px;
  border-bottom-right-radius: 15px;
  box-shadow: 0 1px 0 rgba(0,0,0,0.04);
}

/* Preview Image */
.queue-row-preview {
  height: 100%;
}
.queue-row-preview img {
  border-radius: 15px;
  border: 1px solid rgba(0,0,0,0.06);
  background: rgba(255,255,255,0.9);
  height: 100%;
  object-fit: fill !important;
}

/* Animations */
@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.6; }
  100% { opacity: 1; }
}

/* Scrollbar Styling */
.queue-body::-webkit-scrollbar {
  width: 8px;
}

.queue-body::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.1);
}

.queue-body::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

.queue-body::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* --- Toolbar Graphs & Queue Stats --- */

/* Improve toolbar aesthetics */
#fixed-toolbar {
  background: rgba(30, 30, 30, 0.85);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  backdrop-filter: saturate(150%) blur(6px);
  -webkit-backdrop-filter: saturate(150%) blur(6px);
  gap: 10px;
}

/* Queue stats mini stacked bar */
.queue-stats {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  min-width: 220px;
}
.queue-stats-bar {
  display: flex;
  height: 8px;
  width: 240px;
  border-radius: 6px;
  overflow: hidden;
  background: rgba(255,255,255,0.12);
}
.queue-stats-bar .seg {
  display: block;
  height: 100%;
  transition: width 0.35s ease;
}
.queue-stats-bar .pending { background: #6b7280; }  /* gray */
.queue-stats-bar .running { background: #3b82f6; }  /* blue */
.queue-stats-bar .completed { background: #22c55e; } /* green */
.queue-stats-labels {
  font-size: 0.8rem;
  color: #e5e7eb;
  text-align: center;
  white-space: nowrap;
}

/* Compact stat cards with percentage bars */
.stat-card {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 6px 10px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 8px;
  min-width: 140px;
}
.stat-card .stat-label {
  font-size: 0.7rem;
  color: #e5e7eb;
  opacity: 1;
  letter-spacing: .06em;
  text-transform: uppercase;
}
.stat-card .stat-value {
  font-size: 0.85rem;
  font-weight: 600;
  color: #fff;
}
.stat-card .stat-bar {
  height: 6px;
  width: 100%;
  border-radius: 4px;
  background: rgba(255,255,255,0.12);
  overflow: hidden;
}
.stat-card .stat-bar .fill {
  display: block;
  height: 100%;
  width: 0%;
  transition: width 0.35s ease;
}
/* Color variants for fills */
.stat-card.ram .stat-bar .fill {
  background: linear-gradient(90deg, #60a5fa, #3b82f6);
}
.stat-card.vram .stat-bar .fill {
  background: linear-gradient(90deg, #f59e0b, #ef4444);
}
.stat-card.gpu .stat-bar .fill {
  background: linear-gradient(90deg, #34d399, #10b981);
}

/* Ensure HTML stat components are snug */
.toolbar-stat-html {
  padding: 0 !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .queue-stats-bar { width: 180px; }
  .queue-stats-labels { font-size: 0.75rem; }
  .stat-card { min-width: 120px; padding: 5px 8px; }
}

/* --- Variable-driven updates (no flashing) & compact toolbar --- */

/* Shorter toolbar overall */
#fixed-toolbar {
  padding: 0 8px !important;
  gap: 6px !important;
}

/* Slightly smaller title */
.toolbar-title {
  font-size: 1.2rem !important;
}

/* Queue stats: bind widths and labels via CSS variables */
#queue-stats .queue-stats-bar .pending { width: var(--qs-p, 0%); }
#queue-stats .queue-stats-bar .running { width: var(--qs-r, 0%); }
#queue-stats .queue-stats-bar .completed { width: var(--qs-c, 0%); }
#queue-stats .queue-stats-labels::after { content: var(--qs-label, ''); }

/* Make the queue bar a bit slimmer and narrower */
#queue-stats .queue-stats-bar { height: 6px; width: 200px; }

/* Stack toolbar cards vertically and use variables for values */
#toolbar-stats-stack,
#toolbar-stats-container.stats-stack {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap; /* allow wrapping as before */
  gap: 8px;
  align-items: center;
}
/* Give the stats area more room and allow other toolbar items to shrink */
#toolbar-stats-container {
  flex: initial;
  min-width: 0;
}
/* Allow the title/other columns to shrink so stats can stay in one line */
/* Make queue bar width responsive so it doesn't hog space */
#queue-stats { 
  flex: 0 1 auto; 
  min-width: 160px; 
}
#queue-stats .queue-stats-bar { 
  width: 200px;
}

/* Compact stat cards */
#toolbar-stats-container .stat-card {
  padding: 4px 8px;
  gap: 2px;
}
#toolbar-stats-container .stat-card .stat-bar { height: 4px; }
/* (reverted) allow natural flex behavior for stat cards */

/* Show value via ::after to avoid text rewrites (prevents flashing) */
#toolbar-stats-container .stat-card .stat-value {
  color: transparent; /* hide initial placeholder text */
  position: relative;
}
#toolbar-stats-container .ram .stat-value::after { content: var(--ram-text, 'N/A'); color: #fff; }
#toolbar-stats-container .vram .stat-value::after { content: var(--vram-text, 'N/A'); color: #fff; }
#toolbar-stats-container .gpu  .stat-value::after { content: var(--gpu-text, 'N/A');  color: #fff; }


/* Bind fill widths to CSS variables for smooth transitions without DOM churn */
#toolbar-stats-container .ram  .stat-bar .fill { width: var(--ram-fill, 0%); }
#toolbar-stats-container .vram .stat-bar .fill { width: var(--vram-fill, 0%); }
#toolbar-stats-container .gpu  .stat-bar .fill { width: var(--gpu-fill, 0%); }

/* --- Queue Row Action Button Styles --- */
.queue-row-actions {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 4px 0;
}
.queue-row-action-btn {
  font-size: 12px;
  line-height: 1;
  padding: 4px 10px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.06);
  cursor: pointer;
  background: rgba(74,158,255,0.12);
  color: var(--text-color, #111);
}
.queue-row-action-btn[disabled] {
  opacity: 0.6;
  cursor: not-allowed;
}
.queue-row-action-btn[data-action="cancel"] {
  background: rgba(217, 119, 6, 0.15);
  color: #d97706;
  border-color: rgba(217,119,6,0.25);
}
.queue-row-action-btn[data-action="remove"] {
  background: rgba(0,0,0,0.06);
  color: var(--text-color, #111);
}
